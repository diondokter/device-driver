<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
</head>

<body>
  <script type="module">
    import init, { compile } from './wasm/device_driver_wasm.js';

    async function load() {
      await init();

      const source = document.getElementById('source');
      const code_output = document.getElementById('code_output');
      const diagnostics_output = document.getElementById('diagnostics_output');

      source.addEventListener('change', run_compile);
      source.addEventListener('input', run_compile);

      run_compile();
    }

    function run_compile() {
      var output = compile(source.value);

      code_output.innerText = output.code;
      diagnostics_output.innerText = output.diagnostics;
    }


    load();
  </script>

  <textarea id="source" rows="20" cols="50">
device Foo {
  register-address-type u8

  register Bar {
    address 0
    fields size-bits=8 {}
  }
}
  </textarea>

  <p><code id="diagnostics_output" style="font-family: Consolas; background-color: rgb(255, 192, 192);"></code></p>
  <p><code id="code_output" style="font-family: Consolas;"></code></p>

</body>